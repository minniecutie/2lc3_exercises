Declaration:  ExprV, Exprğ”¹  : Type
Declaration:  Cmd           : Type

Declaration: _â®_             : Cmd â†’ Cmd â†’ Cmd
Declaration: _:=_            : Var â†’ ExprV â†’ Cmd
Declaration: if_then_else_fi : Exprğ”¹ â†’ Cmd â†’ Cmd â†’ Cmd
Declaration: while_do_od     : Exprğ”¹ â†’ Cmd â†’ Cmd

Declaration: State : Type
Declaration: Var : Type
Declaration: Value : Type

Axiom â€œDefinition of `State`â€: State = Var â†’ Value

Declaration: eval : State â†’ ExprV â†’ Value
Declaration: sat  : Exprğ”¹ â†’ set State

Activate type-abbreviation property â€œDefinition of `State`â€

Declaration: _âŠ•â€²_ : (A â†’ B) â†’ â° A , B â± â†’ (A â†’ B)
Axiom â€œDefinition of function overrideâ€:
   (x = z â‡’ (f âŠ•â€² âŸ¨ x, y âŸ©) z = y)
  âˆ§ (x â‰  z â‡’ (f âŠ•â€² âŸ¨ x, y âŸ©) z = f z)

Declaration: âŸ¦_âŸ§ : Cmd â†’ (State â†” State)

Axiom â€œSemantics of :=â€:
   âŸ¦ x := e âŸ§ = { s : State â€¢ âŸ¨ s , s âŠ•â€² âŸ¨ x , eval s e âŸ© âŸ© }
Axiom â€œSemantics of â®â€:   âŸ¦ Câ‚ â® Câ‚‚ âŸ§ = âŸ¦ Câ‚ âŸ§ â¨¾ âŸ¦ Câ‚‚ âŸ§
Axiom â€œSemantics of `if`â€:
   âŸ¦ if B then Câ‚ else Câ‚‚ fi âŸ§  =  (sat B â— âŸ¦ Câ‚ âŸ§)
                                âˆª  (sat B â©¤ âŸ¦ Câ‚‚ âŸ§)

Axiom â€œSemantics of `while`â€:
   âŸ¦ while B do C od âŸ§ = (sat B â— âŸ¦ C âŸ§) * â©¥ sat B

Declaration: _â‡’â…_â†_ : Exprğ”¹ â†’ Cmd â†’ Exprğ”¹ â†’ ğ”¹
Declaration: _â‡’â…â§¼_â§½â†_ : Exprğ”¹ â†’ Cmd â†’ Exprğ”¹ â†’ ğ”¹

Axiom â€œPartial correctnessâ€:  (P â‡’â… C â† Q)  â‰¡   âŸ¦ C âŸ§ â¦‡ sat P â¦ˆ âŠ† sat Q

Theorem â€œPartial correctness via âˆ€â€:
  (P â‡’â… C â† Q)
  â‰¡ âˆ€ sâ‚, sâ‚‚ â€¢ sâ‚ âˆˆ sat P âˆ§ sâ‚ â¦— âŸ¦ C âŸ§ â¦˜ sâ‚‚ â‡’ sâ‚‚ âˆˆ sat Q
Proof:
    P â‡’â… C â† Q
  =âŸ¨ â€œPartial correctnessâ€ âŸ©
    âŸ¦ C âŸ§ â¦‡ sat P â¦ˆ âŠ† sat Q
  =âŸ¨ â€œSet inclusionâ€ âŸ©
    âˆ€ y â€¢ y âˆˆ âŸ¦ C âŸ§ â¦‡ sat P â¦ˆ â‡’ y âˆˆ sat Q
  =âŸ¨ â€œRelational imageâ€ âŸ©
    âˆ€ y â€¢ (âˆƒ x â™ x âˆˆ sat P â€¢ x â¦— âŸ¦ C âŸ§ â¦˜ y) â‡’ y âˆˆ sat Q
  =âŸ¨ â€œWitnessâ€ âŸ©
    âˆ€ y â€¢ âˆ€ x â€¢ x âˆˆ sat P âˆ§ x â¦— âŸ¦ C âŸ§ â¦˜ y â‡’ y âˆˆ sat Q
  =âŸ¨ (8.20a), (8.19) âŸ©
    âˆ€ x , y â€¢ x âˆˆ sat P âˆ§ x â¦— âŸ¦ C âŸ§ â¦˜ y â‡’ y âˆˆ sat Q 
      
Axiom â€œTotal correctnessâ€:
   (P â‡’â…â§¼ C â§½â† Q)
   â‰¡   sat P âŠ† Dom âŸ¦ C âŸ§  âˆ§  âŸ¦ C âŸ§ â¦‡ sat P â¦ˆ âŠ† sat Q

Lemma â€œExpanding total correctnessâ€: 
    sat P âŠ† Dom âŸ¦ C âŸ§ 
  â‰¡ âˆ€ sâ‚ â™ sâ‚ âˆˆ sat P â€¢ âˆƒ sâ‚‚ â€¢ sâ‚ â¦— âŸ¦ C âŸ§ â¦˜ sâ‚‚
Proof:
    sat P âŠ† Dom âŸ¦ C âŸ§
  =âŸ¨ â€œSet inclusionâ€ âŸ©
    âˆ€ y â€¢ y âˆˆ sat P â‡’ y âˆˆ Dom âŸ¦ C âŸ§
  =âŸ¨ â€œMembership in `Dom`â€ âŸ©
    âˆ€ y â€¢ y âˆˆ sat P â‡’ (âˆƒ x â€¢ y â¦— âŸ¦ C âŸ§ â¦˜ x)
  =âŸ¨ â€œTrading for âˆ€â€ (9.2) âŸ©
    âˆ€ y â™ y âˆˆ sat P â€¢ âˆƒ x â€¢ y â¦— âŸ¦ C âŸ§ â¦˜ x  

Theorem â€œTotal correctness via âˆ€â€:
  (P â‡’â…â§¼ C â§½â† Q)
  â‰¡ (âˆ€ sâ‚ â™ sâ‚ âˆˆ sat P â€¢ âˆƒ sâ‚‚ â™ sâ‚ â¦— âŸ¦ C âŸ§ â¦˜ sâ‚‚ â€¢ sâ‚‚ âˆˆ sat Q)
  âˆ§ (âˆ€ sâ‚, sâ‚‚ â€¢ sâ‚ âˆˆ sat P âˆ§ sâ‚ â¦— âŸ¦ C âŸ§ â¦˜ sâ‚‚ â‡’ sâ‚‚ âˆˆ sat Q)
Proof:
    (P â‡’â…â§¼ C â§½â† Q)
  =âŸ¨ â€œTotal correctnessâ€ âŸ©
     sat P âŠ† Dom âŸ¦ C âŸ§  âˆ§  âŸ¦ C âŸ§ â¦‡ sat P â¦ˆ âŠ† sat Q
  =âŸ¨ â€œExpanding total correctnessâ€ âŸ©
       (âˆ€ sâ‚ â™ sâ‚ âˆˆ sat P â€¢ âˆƒ sâ‚‚ â€¢ sâ‚ â¦— âŸ¦ C âŸ§ â¦˜ sâ‚‚)  
     âˆ§ âŸ¦ C âŸ§ â¦‡ sat P â¦ˆ âŠ† sat Q 
  =âŸ¨ â€œPartial correctness via âˆ€â€ with â€œPartial correctnessâ€ âŸ©
       (âˆ€ sâ‚ â™ sâ‚ âˆˆ sat P â€¢ âˆƒ sâ‚‚ â€¢ sâ‚ â¦— âŸ¦ C âŸ§ â¦˜ sâ‚‚)
     âˆ§ (âˆ€ sâ‚, sâ‚‚ â€¢ sâ‚ âˆˆ sat P âˆ§ sâ‚ â¦— âŸ¦ C âŸ§ â¦˜ sâ‚‚ â‡’ sâ‚‚ âˆˆ sat Q)
  â‰¡âŸ¨ (3.62) with subproof for `(âˆ€ sâ‚, sâ‚‚ â€¢ sâ‚ âˆˆ sat P âˆ§ sâ‚ â¦— âŸ¦ C âŸ§ â¦˜ sâ‚‚ â‡’ sâ‚‚ âˆˆ sat Q) â‡’
          ((âˆ€ sâ‚ â™ sâ‚ âˆˆ sat P â€¢ âˆƒ sâ‚‚ â€¢ sâ‚ â¦— âŸ¦ C âŸ§ â¦˜ sâ‚‚ âˆ§ sâ‚‚ âˆˆ sat Q) 
         â‰¡ (âˆ€ sâ‚ â™ sâ‚ âˆˆ sat P â€¢ âˆƒ sâ‚‚ â€¢ sâ‚ â¦— âŸ¦ C âŸ§ â¦˜ sâ‚‚))`:
           âˆ€ sâ‚, sâ‚‚ â€¢ sâ‚ âˆˆ sat P âˆ§ sâ‚ â¦— âŸ¦ C âŸ§ â¦˜ sâ‚‚ â‡’ sâ‚‚ âˆˆ sat Q
         =âŸ¨ â€œNesting for âˆ€â€ âŸ©
           âˆ€ sâ‚ â€¢ âˆ€ sâ‚‚ â€¢ (sâ‚ âˆˆ sat P âˆ§ sâ‚ â¦— âŸ¦ C âŸ§ â¦˜ sâ‚‚ â‡’ sâ‚‚ âˆˆ sat Q)
         =âŸ¨ â€œTrading for âˆ€â€ (9.2) âŸ©
           âˆ€ sâ‚ â€¢ âˆ€ sâ‚‚ â™ sâ‚ âˆˆ sat P âˆ§ sâ‚ â¦— âŸ¦ C âŸ§ â¦˜ sâ‚‚ â€¢ sâ‚‚ âˆˆ sat Q
         =âŸ¨ â€œNesting for âˆ€â€ âŸ©
           âˆ€ sâ‚ â™ sâ‚ âˆˆ sat P â€¢ âˆ€ sâ‚‚ â™ sâ‚ â¦— âŸ¦ C âŸ§ â¦˜ sâ‚‚ â€¢ sâ‚‚ âˆˆ sat Q 
         =âŸ¨ â€œTrading for âˆ€â€ (9.2) âŸ©
           âˆ€ sâ‚ â™ sâ‚ âˆˆ sat P â€¢ âˆ€ sâ‚‚ â€¢ sâ‚ â¦— âŸ¦ C âŸ§ â¦˜ sâ‚‚ â‡’ sâ‚‚ âˆˆ sat Q
         =âŸ¨ (3.60) âŸ©
           âˆ€ sâ‚ â™ sâ‚ âˆˆ sat P â€¢ âˆ€ sâ‚‚ â€¢ sâ‚ â¦— âŸ¦ C âŸ§ â¦˜ sâ‚‚ âˆ§ sâ‚‚ âˆˆ sat Q â‰¡ sâ‚ â¦— âŸ¦ C âŸ§ â¦˜ sâ‚‚
         â‡’âŸ¨ â€œMonotonicity of âˆ€â€ with â€œLeibniz for âˆƒ bodyâ€ âŸ©
           âˆ€ sâ‚ â™ sâ‚ âˆˆ sat P â€¢ (âˆƒ sâ‚‚ â€¢ sâ‚ â¦— âŸ¦ C âŸ§ â¦˜ sâ‚‚ âˆ§ sâ‚‚ âˆˆ sat Q) â‰¡ (âˆƒ sâ‚‚ â€¢ sâ‚ â¦— âŸ¦ C âŸ§ â¦˜ sâ‚‚)
         â‡’âŸ¨ â€œLeibniz for âˆ€ bodyâ€ âŸ©
             (âˆ€ sâ‚ â™ sâ‚ âˆˆ sat P â€¢ âˆƒ sâ‚‚ â€¢ sâ‚ â¦— âŸ¦ C âŸ§ â¦˜ sâ‚‚ âˆ§ sâ‚‚ âˆˆ sat Q) 
           â‰¡ (âˆ€ sâ‚ â™ sâ‚ âˆˆ sat P â€¢ âˆƒ sâ‚‚ â€¢ sâ‚ â¦— âŸ¦ C âŸ§ â¦˜ sâ‚‚)     
     âŸ© 
       (âˆ€ sâ‚ â™ sâ‚ âˆˆ sat P â€¢ âˆƒ sâ‚‚ â€¢ sâ‚ â¦— âŸ¦ C âŸ§ â¦˜ sâ‚‚ âˆ§ sâ‚‚ âˆˆ sat Q)
     âˆ§ (âˆ€ sâ‚, sâ‚‚ â€¢ sâ‚ âˆˆ sat P âˆ§ sâ‚ â¦— âŸ¦ C âŸ§ â¦˜ sâ‚‚ â‡’ sâ‚‚ âˆˆ sat Q)
  =âŸ¨ â€œTrading for âˆƒâ€ âŸ©
       (âˆ€ sâ‚ â™ sâ‚ âˆˆ sat P â€¢ âˆƒ sâ‚‚ â™ sâ‚ â¦— âŸ¦ C âŸ§ â¦˜ sâ‚‚ â€¢ sâ‚‚ âˆˆ sat Q)
     âˆ§ (âˆ€ sâ‚, sâ‚‚ â€¢ sâ‚ âˆˆ sat P âˆ§ sâ‚ â¦— âŸ¦ C âŸ§ â¦˜ sâ‚‚ â‡’ sâ‚‚ âˆˆ sat Q) 

Precedence 130 for: Â¬â€²_
Declaration: Â¬â€²_ : Exprğ”¹ â†’ Exprğ”¹
Axiom â€œNegation on `Exprğ”¹`â€: sat (Â¬â€² B) = ~ (sat B)

Precedence 40 for: _âˆ§â€²_
Declaration: _âˆ§â€²_ : Exprğ”¹ â†’ Exprğ”¹ â†’ Exprğ”¹
Axiom â€œConjunction on `Exprğ”¹`â€: sat (Bâ‚ âˆ§â€² Bâ‚‚) = sat Bâ‚ âˆ© sat Bâ‚‚

Derived inference rule â€œSequenceâ€:
    `P  â‡’â… Câ‚ â†  Q`,  `Q  â‡’â… Câ‚‚ â†  R`
   âŠ¦â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
      `P  â‡’â… Câ‚ â® Câ‚‚ â†  R`
Proof:
  Assuming (C1) `P  â‡’â… Câ‚ â†  Q` and using with â€œPartial correctnessâ€,
           (C2) `Q  â‡’â… Câ‚‚ â†  R` and using with â€œPartial correctnessâ€:
      P  â‡’â… Câ‚ â® Câ‚‚ â†  R
    =âŸ¨ â€œPartial correctnessâ€ âŸ©
      âŸ¦ Câ‚ â® Câ‚‚ âŸ§ â¦‡ sat P â¦ˆ âŠ† sat R
    =âŸ¨ â€œSemantics of â®â€ âŸ©
      (âŸ¦ Câ‚ âŸ§ â¨¾ âŸ¦ Câ‚‚ âŸ§) â¦‡ sat P â¦ˆ âŠ† sat R
    =âŸ¨ â€œRelational image of â¨¾â€ âŸ©
      âŸ¦ Câ‚‚ âŸ§ â¦‡ âŸ¦ Câ‚ âŸ§ â¦‡ sat P â¦ˆ â¦ˆ âŠ† sat R
    =âŸ¨ Subproof:
           âŸ¦ Câ‚‚ âŸ§ â¦‡ âŸ¦ Câ‚ âŸ§ â¦‡ sat P â¦ˆ â¦ˆ
         âŠ†âŸ¨ ? âŸ©
           âŸ¦ Câ‚‚ âŸ§ â¦‡ sat Q â¦ˆ
         âŠ†âŸ¨ Assumption (C2) âŸ©
           sat R         
      âŸ©
      true
 

â•â•â• (C1): âŸ¦ Câ‚ âŸ§ â¦‡ sat P â¦ˆ âŠ† sat Q
â•â•â• (C2): âŸ¦ Câ‚‚ âŸ§ â¦‡ sat Q â¦ˆ âŠ† sat R   
    
Derived inference rule â€œConditionalâ€:

      `B âˆ§â€² P â‡’â… Câ‚ â† Q`,   `Â¬â€² B âˆ§â€² P â‡’â… Câ‚‚ â† Q`
    âŠ¦â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
        `P â‡’â… if B then Câ‚ else Câ‚‚ fi â† Q`

Proof:
  Assuming (C1) `B âˆ§â€² P  â‡’â… Câ‚ â†  Q` and using with â€œPartial correctnessâ€,
           (C2) `Â¬â€² B âˆ§â€² P  â‡’â… Câ‚‚ â†  Q` and using with â€œPartial correctnessâ€:
      P  â‡’â… if B then Câ‚ else Câ‚‚ fi â†  Q
    =âŸ¨ â€œPartial correctnessâ€ âŸ©
      âŸ¦ if B then Câ‚ else Câ‚‚ fi âŸ§ â¦‡ sat P â¦ˆ âŠ† sat Q
    =âŸ¨ â€œSemantics of `if`â€ âŸ©
      ((sat B â— âŸ¦ Câ‚ âŸ§) âˆª (sat B â©¤ âŸ¦ Câ‚‚ âŸ§)) â¦‡ sat P â¦ˆ âŠ† sat Q 
    
â•â•â• (C1) âŸ¦ Câ‚ âŸ§ â¦‡ sat (B âˆ§â€² P) â¦ˆ âŠ† sat Q 
â•â•â•    â‰¡ âŸ¦ Câ‚ âŸ§ â¦‡ sat B âˆ© sat P â¦ˆ âŠ† sat Q
â•â•â• (C2) âŸ¦ Câ‚‚ âŸ§ â¦‡ sat (Â¬â€² B âˆ§â€² P) â¦ˆ âŠ† sat Q 
â•â•â•    â‰¡ âŸ¦ Câ‚‚ âŸ§ â¦‡ sat (Â¬â€² B) âˆ© sat P) â¦ˆ âŠ† sat Q
â•â•â•    â‰¡ âŸ¦ Câ‚‚ âŸ§ â¦‡ ~ sat B âˆ© sat P) â¦ˆ âŠ† sat Q

Derived inference rule â€œWhileâ€:
                 `B âˆ§â€² Q  â‡’â… C â†  Q`
        âŠ¦â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
          `Q  â‡’â… while B do C od â†  Â¬â€² B âˆ§â€² Q`
Proof:
  Assuming â€œC-Invâ€ `B âˆ§â€² Q  â‡’â… C â†  Q`:
      Q  â‡’â… while B do C od â†  Â¬â€² B âˆ§â€² Q
    â‡âŸ¨ ? âŸ©
      true

Declaration: substEğ”¹ : Exprğ”¹ â†’ Var â†’ ExprV â†’ Exprğ”¹

Theorem â€œAssignmentâ€: substEğ”¹ P x E  â‡’â… x := E â†  P
