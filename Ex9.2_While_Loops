## Those are the lemmas that should be given as axioms, but in fact they aren't, so I will proof them.
## They are not used in this exercise. 

Lemma â€œDefinition of `reverse` for â–¹â€: y â—ƒ reverse xs = reverse (xs â–¹ y)
Proof:
  By induction on `xs : Seq A`:
    Base case `y â—ƒ reverse ğœ– = reverse (ğœ– â–¹ y)`:
        y â—ƒ reverse ğœ– = reverse (ğœ– â–¹ y)
      =âŸ¨ â€œDefinition of `reverse` for ğœ–â€, â€œDefinition of â–¹ for ğœ–â€ âŸ©
        y â—ƒ ğœ– = reverse (y â—ƒ ğœ–)
      =âŸ¨ â€œDefinition of `reverse` for â—ƒâ€ âŸ©
        y â—ƒ ğœ– = reverse ğœ– â–¹ y
      =âŸ¨ â€œDefinition of `reverse` for ğœ–â€âŸ©  
        y â—ƒ ğœ– = ğœ– â–¹ y â€” This is â€œDefinition of â–¹ for ğœ–â€
    Induction step `âˆ€ x : A â€¢ y â—ƒ reverse (x â—ƒ xs) = reverse ((x â—ƒ xs) â–¹ y)`:
      For any `x : A`:
          reverse ((x â—ƒ xs) â–¹ y)
        =âŸ¨ â€œDefinition of â–¹ for â—ƒâ€ âŸ©
          reverse (x â—ƒ (xs â–¹ y))
        =âŸ¨ â€œDefinition of `reverse` for â—ƒâ€ âŸ©
          reverse (xs â–¹ y) â–¹ x
        =âŸ¨ Induction hypothesis âŸ©
          (y â—ƒ reverse xs) â–¹ x
        =âŸ¨ â€œDefinition of â–¹ for â—ƒâ€ âŸ©  
          y â—ƒ (reverse xs â–¹ x)
        =âŸ¨ â€œDefinition of `reverse` for â—ƒâ€ âŸ© 
          y â—ƒ reverse (x â—ƒ xs)

Lemma â€œDouble reverseâ€: xs = reverse (reverse xs)
Proof:
  By induction on `xs : Seq A`:
    Base case `ğœ– = reverse (reverse ğœ–)`:
      By â€œDefinition of `reverse` for ğœ–â€, â€œReflexivity of =â€
    Induction step `âˆ€ x : A â€¢ x â—ƒ xs = reverse (reverse (x â—ƒ xs))`:
      For any `x : A`:
          reverse (reverse (x â—ƒ xs))
        =âŸ¨ â€œDefinition of `reverse` for â—ƒâ€ âŸ©
          reverse (reverse xs â–¹ x)
        =âŸ¨ â€œDefinition of `reverse` for â–¹â€ âŸ©  
          x â—ƒ reverse (reverse xs)
        =âŸ¨ Induction hypothesis âŸ©
          x â—ƒ xs   

Lemma â€œCancellation of â–¹â€: xs â–¹ x = ys â–¹ y â‰¡  x = y âˆ§ xs = ys
Proof:
  By induction on `xs : Seq A`:
    Base case `ğœ– â–¹ x = ys â–¹ y â‰¡  x = y âˆ§ ğœ– = ys`:
      By induction on `ys : Seq A`:
        Base case `ğœ– â–¹ x = ğœ– â–¹ y â‰¡  x = y âˆ§ ğœ– = ğœ–`:
            ğœ– â–¹ x = ğœ– â–¹ y
          =âŸ¨ â€œDefinition of â–¹ for ğœ–â€ âŸ© 
            x â—ƒ ğœ– = y â—ƒ ğœ– 
          =âŸ¨ â€œCancellation of â—ƒâ€ âŸ©
            x = y âˆ§ ğœ– = ğœ–  
        Induction step `âˆ€ t : A â€¢ ğœ– â–¹ x = (t â—ƒ ys) â–¹ y â‰¡  x = y âˆ§ ğœ– = (t â—ƒ ys)`:
          For any `t : A`:
              ğœ– â–¹ x = (t â—ƒ ys) â–¹ y
            =âŸ¨ â€œDefinition of â–¹ for ğœ–â€ , â€œDefinition of â–¹ for â—ƒâ€ âŸ©
              x â—ƒ ğœ– = t â—ƒ (ys â–¹ y)
            =âŸ¨ â€œCancellation of â—ƒâ€ âŸ©
              x = t âˆ§ ğœ– = ys â–¹ y
            =âŸ¨ â€œSnoc is not emptyâ€, â€œZero of âˆ§â€ âŸ©
              false
            =âŸ¨ â€œZero of âˆ§â€, â€œCons is not emptyâ€ âŸ©
              x = y âˆ§ ğœ– = (t â—ƒ ys)    
    Induction step `âˆ€ t : A â€¢ (t â—ƒ xs) â–¹ x = ys â–¹ y â‰¡  x = y âˆ§ (t â—ƒ xs) = ys`:
      For any `t`:
        By induction on `ys : Seq A`:
          Base case `(t â—ƒ xs) â–¹ x = ğœ– â–¹ y â‰¡  x = y âˆ§ (t â—ƒ xs) = ğœ–`:
              (t â—ƒ xs) â–¹ x = ğœ– â–¹ y
            =âŸ¨ â€œDefinition of â–¹ for ğœ–â€ , â€œDefinition of â–¹ for â—ƒâ€ âŸ©
              t â—ƒ (xs â–¹ x) = y â—ƒ ğœ– 
            =âŸ¨ â€œCancellation of â—ƒâ€ âŸ©
              t = y âˆ§ xs â–¹ x = ğœ– 
            =âŸ¨ â€œSnoc is not emptyâ€, â€œZero of âˆ§â€ âŸ©
              false
            =âŸ¨ â€œZero of âˆ§â€, â€œCons is not emptyâ€ âŸ©
              x = y âˆ§ (t â—ƒ xs) = ğœ–     
          Induction step `âˆ€ k â€¢ (t â—ƒ xs) â–¹ x = (k â—ƒ ys) â–¹ y â‰¡  x = y âˆ§ (t â—ƒ xs) = (k â—ƒ ys)`:
            For any `k`:
                (t â—ƒ xs) â–¹ x = (k â—ƒ ys) â–¹ y
              =âŸ¨ â€œDefinition of â–¹ for â—ƒâ€ âŸ© 
                 t â—ƒ (xs â–¹ x) = k â—ƒ (ys â–¹ y)
              =âŸ¨ â€œCancellation of â—ƒâ€ âŸ©
                 t = k âˆ§ xs â–¹ x = ys â–¹ y
              =âŸ¨ Induction hypothesis `xs â–¹ x = ys â–¹ y â‰¡  x = y âˆ§ xs = ys` âŸ©  
                 t = k âˆ§ x = y âˆ§ xs = ys
              =âŸ¨ â€œCancellation of â—ƒâ€ âŸ©
                 x = y âˆ§ (t â—ƒ xs) = (k â—ƒ ys) 

Lemma â€œReverse equalâ€: xs = ys â‰¡ reverse xs = reverse ys
Proof:
  By induction on `xs : Seq A`:
    Base case `ğœ– = ys â‰¡ reverse ğœ– = reverse ys`:
      By induction on `ys : Seq A`:
        Base case `ğœ– = ğœ– â‰¡ reverse ğœ– = reverse ğœ–`:
          By â€œDefinition of `reverse` for ğœ–â€, â€œReflexivity of =â€
        Induction step `âˆ€ y : A â€¢ ğœ– = y â—ƒ ys â‰¡ reverse ğœ– = reverse (y â—ƒ ys)`:
          For any `y : A`:
              reverse ğœ– = reverse (y â—ƒ ys)
            =âŸ¨ â€œDefinition of `reverse` for â—ƒâ€ , â€œDefinition of `reverse` for ğœ–â€ âŸ©
              ğœ– = reverse ys â–¹ y
            =âŸ¨ â€œSnoc is not emptyâ€ âŸ©
              false
            =âŸ¨ â€œCons is not emptyâ€ âŸ©
              ğœ– = y â—ƒ ys        
    Induction step `âˆ€ x : A â€¢ x â—ƒ xs = ys â‰¡ reverse (x â—ƒ xs) = reverse ys`:
      For any `x : A`:
        By induction on `ys : Seq A`:
          Base case `x â—ƒ xs = ğœ– â‰¡ reverse (x â—ƒ xs) = reverse ğœ–`:
              reverse (x â—ƒ xs) = reverse ğœ–
            =âŸ¨ â€œDefinition of `reverse` for â—ƒâ€ , â€œDefinition of `reverse` for ğœ–â€ âŸ©
              reverse xs â–¹ x = ğœ– 
            =âŸ¨ â€œSnoc is not emptyâ€ âŸ©
              false
            =âŸ¨ â€œCons is not emptyâ€ âŸ©
              x â—ƒ xs = ğœ–   
          Induction step `âˆ€ y : A â€¢ x â—ƒ xs = y â—ƒ ys â‰¡ reverse (x â—ƒ xs) = reverse (y â—ƒ ys)`:
            For any `y : A`:
                reverse (x â—ƒ xs) = reverse (y â—ƒ ys)
              =âŸ¨ â€œDefinition of `reverse` for â—ƒâ€ âŸ©
                reverse xs â–¹ x = reverse ys â–¹ y
              =âŸ¨ â€œCancellation of â–¹â€ âŸ© 
                reverse xs = reverse ys âˆ§ x = y
              =âŸ¨ Induction hypothesis `xs = ys â‰¡ reverse xs = reverse ys` âŸ©
                xs = ys âˆ§ x = y
              =âŸ¨ â€œCancellation of â—ƒâ€ âŸ©
                x â—ƒ xs = y â—ƒ ys    

## End lemmas

## While-loop examples
Theorem â€œWhile-exampleâ€:
      Pre
    â‡’â…  INIT â®
        while B
          do
            C
          od â®
        FINAL
      â†
      Post
Proof:
    Pre    â•â•â•  Precondition
  â‡’â… INIT â†  âŸ¨ ? âŸ©
    Q      â•â•â•  Invariant
  â‡’â… while B do
        C
      od â†   âŸ¨ â€œWhileâ€ with subproof:
          B âˆ§ Q     â•â•â•  Loop condition and invariant
        â‡’â… C â†  âŸ¨ ? âŸ©
          Q         â•â•â•  Invariant
    âŸ©
    Â¬ B âˆ§ Q   â•â•â• Negated loop condition, and invariant
  â‡’â… FINAL â†  âŸ¨ ? âŸ©
    Post      â•â•â•  Postcondition
    
## End example


Theorem â€œProper initialisation for `rev`â€:
      xs = xsâ‚€
    â‡’â… ys := ğœ– â†
      reverse xs âŒ¢ ys = reverse xsâ‚€
Proof:
    xs = xsâ‚€
  â‡’âŸ¨ â€œLeibnizâ€ âŸ©
    (reverse z)[z â‰” xs] = (reverse z)[z â‰” xsâ‚€]
  =âŸ¨ Substitution âŸ©   
    reverse xs = reverse xsâ‚€
  =âŸ¨ â€œRight-identity of âŒ¢â€ âŸ© 
    reverse xs âŒ¢ ğœ– = reverse xsâ‚€
  â‡’â… ys := ğœ– â† âŸ¨ â€œAssignmentâ€ with Substitution âŸ© 
    reverse xs âŒ¢ ys = reverse xsâ‚€
 
 
Theorem â€œReversing of singly-linked listsâ€:
      xs = xsâ‚€
    â‡’â…  ys := ğœ– â®
        while xs â‰  ğœ–
          do
            ys := head xs â—ƒ ys â®
            xs := tail xs
          od
      â†
      ys = reverse xsâ‚€
Proof:
    xs = xsâ‚€    â•â•â•  Precondition
  â‡’âŸ¨ â€œLeibnizâ€ âŸ©
    (reverse z)[z â‰” xs] = (reverse z)[z â‰” xsâ‚€]
  =âŸ¨ Substitution âŸ© 
    reverse xs = reverse xsâ‚€
  =âŸ¨ â€œRight-identity of âŒ¢â€ âŸ© 
    reverse xs âŒ¢ ğœ– = reverse xsâ‚€
  â‡’â… ys := ğœ– â†  âŸ¨ â€œAssignmentâ€ with Substitution âŸ©
    reverse xs âŒ¢ ys = reverse xsâ‚€     â•â•â•  Invariant
  â‡’â… while xs â‰  ğœ– do
        ys := head xs â—ƒ ys â®
        xs := tail xs
      od â†âŸ¨ â€œWhileâ€ with â€œInvariant for `rev`â€ âŸ©
    Â¬ (xs â‰  ğœ–)  âˆ§  reverse xs âŒ¢ ys = reverse xsâ‚€   â•â•â• Negated loop condition, and invariant
  =âŸ¨ â€œDefinition of â‰ â€, â€œDouble negationâ€ âŸ©
    xs = ğœ– âˆ§ reverse xs âŒ¢ ys = reverse xsâ‚€
  =âŸ¨ Substitution âŸ©
    xs = ğœ– âˆ§ (reverse ds âŒ¢ ys = reverse xsâ‚€)[ds â‰” xs]
  =âŸ¨ â€œReplacementâ€ (3.84a) , Substitution âŸ©
    xs = ğœ– âˆ§ reverse ğœ– âŒ¢ ys = reverse xsâ‚€
  =âŸ¨ â€œDefinition of `reverse` for ğœ–â€, â€œLeft-identity of âŒ¢â€ âŸ©
    xs = ğœ– âˆ§ ys = reverse xsâ‚€ 
  â‡’âŸ¨ â€œWeakeningâ€ (3.76b) âŸ©
    ys = reverse xsâ‚€      â•â•â•  Postcondition
